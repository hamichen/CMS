!function(e){e.fn.EasyTree=function(n){var t={isMoveMode:!1,i18n:{deleteNull:"請選擇要刪除的項目。",deleteConfirmation:"您確定要刪除這個項目嗎？",confirmButtonLabel:"確定",editNull:"請選擇要編輯的項目。",editMultiple:"一次只能編輯一個項目",addMultiple:"請選擇一個項目來新增",collapseTip:"收起分支",expandTip:"展開分支",selectTip:"選取",unselectTip:"取消選取",editTip:"編輯",addTip:"新增",deleteTip:"刪除",cancelButtonLabel:"取消"},setting:{branchOpenIcon:"fa-folder-open-o",branchCloseIcon:"fa-folder-o",leafIcon:"fa-file-o"}};n=e.extend(t,n);var a=this;return a.on("click","li.parent_li > span > span",function(t){var a=e(this),i=a.parent().parent("li.parent_li").find(" > ul > li");i.length<1?a.hasClass(n.setting.branchCloseIcon)?a.attr("title",n.i18n.collapseTip).addClass(n.setting.branchOpenIcon).removeClass(n.setting.branchCloseIcon):a.attr("title",n.i18n.expandTip).addClass(n.setting.branchCloseIcon).removeClass(n.setting.branchOpenIcon):i.is(":visible")?(i.hide("normal"),a.attr("title",n.i18n.expandTip).addClass(n.setting.branchCloseIcon).removeClass(n.setting.branchOpenIcon)):(i.show("fast"),a.attr("title",n.i18n.collapseTip).addClass(n.setting.branchOpenIcon).removeClass(n.setting.branchCloseIcon)),t.stopPropagation()}),a.on("click","li > span > a",function(i){var s=e(this).parent().parent();return t.isMoveMode?(s.hasClass("li_selected")?alert("無法移動到同一個位置!!\n\n請重新選擇其他位置"):0==s.attr("data-typeid")?s.attr("data-statusid")>0?a.trigger("easyTree.move",s):alert("您選擇的目錄是校務評鑑固定的資料，無法進行異動。\n\n請重新選擇"):alert("請選擇一個目錄作為移動的目標"),!1):(s.hasClass("li_selected")?(e(this).attr("title",n.i18n.selectTip),s.removeClass("li_selected"),a.trigger("easyTree.unselected")):(a.find("li.li_selected").removeClass("li_selected").find("> span > a").attr("title",n.i18n.selectTip),e(this).attr("title",n.i18n.unselectTip),s.addClass("li_selected"),a.trigger("easyTree.selected",s)),void i.stopPropagation())}),e.fn.EasyTree.buildTree=function(){e.each(a.find("ul > li"),function(){var t,a=e(this);if(0==a.data("typeid")){a.addClass("parent_li");var i='<span><span class="fa '+n.setting.branchCloseIcon+' fa-lg" title="'+n.i18n.expandTip+'"></span><a href="javascript: void(0);" title="'+n.i18n.selectTip+'">',s="</a></span>";if(a.is("li:has(ul)")){var l=a.find(" > ul");l.find("> li").hide(),l.remove(),t=a.text(),a.html(i+t+s).append(l)}else t=a.text(),a.html(i+t+s)}else t=a.text(),a.html('<span><span class="fa '+n.setting.leafIcon+' fa-lg"></span><a href="javascript: void(0);" title="'+n.i18n.selectTip+'">'+t+"</a></span>")})},e.fn.EasyTree.addItem=function(t){var i=a.find("li.li_selected");i.length<=0?alert("尚未選取項目"):i.length>1?alert("發現重複選取項目，請重新載入頁面。"):i.find(" > ul").length>0?(i.find(" > span > span").addClass(n.setting.branchOpenIcon).removeClass(n.setting.branchCloseIcon),i.find(" > ul").append(t)):(i.find(" > span > span").addClass(n.setting.branchOpenIcon).removeClass(n.setting.branchCloseIcon),i.append(e("<ul></ul>")).find(" > ul").append(t))},e.fn.EasyTree.updateItem=function(e){var t=a.find("li.li_selected");t.length<=0?alert("尚未選取項目"):t.length>1?alert("發現重複選取項目，請重新載入頁面。"):(0==e.typeID?(t.addClass("parent_li"),t.find(">span>span").removeClass("glyphicon-file").addClass(n.setting.branchCloseIcon).attr("title",n.i18n.expandTip)):(t.removeClass("parent_li"),t.find(">span>span").removeClass().addClass("glyphicon glyphicon-file").removeAttr("title")),t.find(">span>a").text(e.title),t.attr("data-typeid",e.typeID),a.trigger("toolbar.refresh"))},e.fn.EasyTree.moveItem=function(t,a){var i=e("#m"+t).remove(),s=e("#m"+a),l=s.find(">span>span");l.hasClass(n.setting.branchCloseIcon)&&l.trigger("click"),s.find(" > ul").length>0?s.find(" > ul").append(i):s.append(e("<ul></ul>")).find(" > ul").append(i)},e.fn.EasyTree.setMoveMode=function(e){t.isMoveMode=e},e.fn.EasyTree.sortItem=function(e,n){for(var t=a.find("#m"+e+">ul"),i=0;i<n.length;i++){var s=String(n[i]).substr(5);a.find("#m"+s).appendTo(t)}},e.fn.EasyTree.delItem=function(){var e=a.find("li.li_selected");e.parent().find(">li").length>1?e.remove():e.parent().remove()},e.fn.EasyTree.openAll=function(){a.find("li.parent_li").each(function(){e(this).find("> ul > li").show("fast").end().find("> span > span.fa").attr("title",n.i18n.collapseTip).addClass(n.setting.branchOpenIcon).removeClass(n.setting.branchCloseIcon)})},e.fn.EasyTree.closeAll=function(){a.find("li.parent_li").each(function(){e(this).find("> ul > li").hide("fast").end().find("> span > span.fa").attr("title",n.i18n.expandTip).addClass(n.setting.branchCloseIcon).removeClass(n.setting.branchOpenIcon)})},a}}(jQuery);